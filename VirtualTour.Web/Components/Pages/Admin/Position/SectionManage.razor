@page "/admin/sections"
@using System.Globalization
@layout AdminLayout
@using BlazorBootstrap
@using VirtualTour.Model
@using VirtualTour.Web.Components.BaseComponents
@using MudBlazor
@using VirtualTour.Web.Components.Layout
<PermissionView Permission="Admin.View">
      <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4">
            <MudText Typo="Typo.h3" Class="fw-bold">Section List</MudText>
            <MudButton  Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary" @onclick="ToggleCreateCard">
                <MudIcon Icon="@Icons.Material.Filled.Add" /> Create New Section
                </MudButton>
    </MudStack>
</PermissionView>
@if (Sections == null)
{
    <p>Loading sections...</p>
}
else
{
     <MudContainer Class="mt-4 w-75" Style="width: 100%; max-width: none;">
    <MudDataGrid T="SectionModel"
                 Items="@Sections"
                 @ref="SectionGrid"
                 Filterable="true"
                 Sortable="true"
                 PageSize="5"
                 Dense="true"
                 FilterMode="@DataGridFilterMode.ColumnFilterRow">
        <Columns>
                <PropertyColumn Filterable="false" Property="x => x.Id" Title="ID" />
            <PropertyColumn Property="x => x.SectName" Title="Section Name" />
                    <PropertyColumn Filterable="false" Property="x => x.CreatedAt" Title="Created Date">

                   <CellTemplate>
                            @context.Item.CreatedAt.ToString("dd/MM/yyyy", CultureInfo.InvariantCulture)
                   </CellTemplate>
            </PropertyColumn>
            <PropertyColumn Property="x => x.IsActive" Title="Active">
                  <CellTemplate>
                    @if (context.Item.IsActive)
                    {
                            <MudChip Color="Color.Primary" Style="width:50px">Yes</MudChip>
                    }
                    else
                    {
                            <MudChip Color="Color.Error" Style="width:50px">No</MudChip>
                    }
            </CellTemplate>
            </PropertyColumn>
            <TemplateColumn  Filterable="false" Sortable="false">
                <CellTemplate>
                     <MudStack Row="true" Spacing="2">
                                <PermissionView Permission="Roles.Edit">
                                  <MudTooltip Text="Edit">
                                <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                               Size="Size.Small"
                                               Color="Color.Primary"
                                               OnClick="@(() => EditSection(context.Item))" />
                                </MudTooltip>
                                </PermissionView>
                                 <PermissionView Permission="Roles.Delete">
                                <MudTooltip Text="Delete">
                                    <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                                   Size="Size.Small"
                                                   Color="Color.Error"
                                                   OnClick="@(() => { DeleteId = context.Item.Id; OnShowModalDeleteClick(); })" />
                                </MudTooltip>
                                </PermissionView>
                        </MudStack>
                </CellTemplate>
            </TemplateColumn>
        </Columns>
        <PagerContent>
            <MudDataGridPager T="SectionModel" />
        </PagerContent>
    </MudDataGrid>
    </MudContainer>
}

<Modal @ref="ModalDelete" title="Notification">
    <BodyTemplate>
        Are you sure you want to delete this role?
    </BodyTemplate>
    <FooterTemplate>
        <Button Color="ButtonColor.Primary" style="width:80px" @onclick="HandleDelete">Yes</Button>
        <Button Color="ButtonColor.Secondary" @onclick="OnHideModalDeleteClick">Cancel</Button>
    </FooterTemplate>
</Modal>

<Modal @ref="ModalCreate" title="Create New Role" IsVerticallyCentered="true" IsScrollable="true">
    <BodyTemplate>
        <div class="card-body">
            <div class="form-group mb-3">
                    <MudTextField Style="background-color: white;"
                                  Required="true" Label="Section Name"
                                  @bind-Value="newSection.SectName" Variant="Variant.Outlined" />
            </div>
            <div class="form-group mb-3">
                <label>Active</label>
                <input type="checkbox" class="form-check-input" @bind="newSection.IsActive" />
            </div>
        </div>
    </BodyTemplate>
    <FooterTemplate>
        <Button Color="ButtonColor.Primary" style="width:180px" @onclick="CreateSection">Create Section</Button>
        <Button Color="ButtonColor.Secondary" @onclick="OnHideModalCreateClick">Cancel</Button>
    </FooterTemplate>
</Modal>

<Modal @ref="ModalEdit" title="Update Role" IsVerticallyCentered="true" IsScrollable="true">
    <BodyTemplate>
        <div class="card-body">
            <div class="form-group mb-3">
                    <MudTextField Style="background-color: white;"
                                  Required="true" Label="Section Name"
                                  @bind-Value="editingSection.SectName" Variant="Variant.Outlined" />
            </div>
            <div class="form-group mb-3">
                <label>Active</label>
                <input type="checkbox" class="form-check-input" @bind="editingSection.IsActive" />
            </div>
        </div>
    </BodyTemplate>
    <FooterTemplate>
        <Button Color="ButtonColor.Primary" style="width:180px" @onclick="() => UpdateSection(editingSection)">Update Role</Button>
        <Button Color="ButtonColor.Secondary" @onclick="OnHideModalEditClick">Cancel</Button>
    </FooterTemplate>
</Modal>
@code {
    private async Task<GridDataProviderResult<SectionModel>> RolesDataProvider(GridDataProviderRequest<SectionModel> request)
    {
        return await Task.FromResult(request.ApplyTo(Sections));
    }
}
